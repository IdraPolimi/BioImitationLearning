
global dcps;
global massimo
global minimo
T1=[ -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.30983, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.30983, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.30983, -0.31136, -0.31136, -0.30983, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.31136, -0.30983, -0.30983, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30983, -0.30829, -0.30983, -0.30676, -0.30676, -0.30522, -0.30522, -0.30522, -0.30522, -0.30522, -0.30522, -0.30676, -0.30676, -0.30676, -0.30676, -0.30522, -0.30676, -0.30676, -0.30676, -0.30676, -0.30522, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30676, -0.30829, -0.30676, -0.30676, -0.30676, -0.30829, -0.30829, -0.30829, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31136, -0.31289, -0.32056, -0.32977, -0.33437, -0.34971, -0.35585, -0.37425, -0.38499, -0.38806, -0.39266, -0.39420, -0.39420, -0.39420, -0.39420, -0.39420, -0.39420, -0.39420, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266, -0.39266];
T2=[ -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.88993, -1.89146, -1.89146, -1.89146, -1.88993, -1.89146, -1.88993, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89146, -1.89300, -1.89300, -1.89300, -1.89300, -1.89300, -1.89300, -1.89913, -1.89913, -1.89913, -1.89913, -1.89913, -1.89913, -1.90067, -1.90067, -1.90067, -1.90067, -1.90067, -1.90067, -1.90067, -1.90220, -1.90220, -1.90374, -1.90527, -1.90834, -1.91141, -1.91447, -1.91601, -1.92061, -1.92368, -1.92675, -1.92828, -1.93748, -1.94055, -1.95436, -1.95896, -1.97277, -1.98044, -1.98504, -1.99884, -2.00958, -2.02032, -2.02952, -2.03413, -2.04640, -2.05100, -2.06020, -2.06634, -2.06787, -2.06787, -2.06634, -2.05867, -2.05867, -2.06174, -2.06787, -2.07248, -2.07401, -2.08015, -2.08475, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.08567, -2.04793, -2.02952, -1.98044, -1.94822, -1.86692, -1.79329, -1.76107, -1.75494, -1.74113, -1.72119, -1.69204, -1.66136, -1.63682, -1.61228, -1.58466, -1.55859, -1.51257, -1.42206, -1.38064, -1.31775, -1.30394, -1.28707, -1.26559, -1.25332, -1.21190, -1.14901, -1.12293, -1.10299, -1.08611, -1.06310, -1.04316, -1.02169, -1.00788, -0.97720, -0.94499, -0.94499, -0.90357, -0.89130, -0.86982, -0.85908, -0.82687, -0.81306, -0.79159, -0.77164, -0.74557, -0.72716, -0.71182, -0.69955, -0.69341, -0.67960, -0.66426, -0.64892, -0.63819, -0.63052, -0.62131, -0.61671, -0.61057, -0.59063, -0.57529, -0.56302, -0.55228, -0.53848, -0.53848, -0.52774, -0.52160, -0.51240, -0.50933, -0.50626, -0.50473, -0.50013, -0.49859, -0.50013, -0.50013, -0.50013, -0.50013, -0.50013, -0.50013, -0.50166, -0.50166, -0.50166, -0.50166, -0.50166, -0.50166, -0.50166, -0.50166, -0.50166, -0.50319, -0.50626, -0.50933, -0.50933, -0.50933, -0.50933, -0.50780, -0.50780, -0.50626, -0.50780, -0.50626, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50780, -0.50626, -0.50780, -0.50626, -0.50626, -0.50626, -0.50626, -0.50626, -0.50780, -0.50780, -0.50626, -0.50626, -0.50626, -0.50626, -0.50626, -0.50626, -0.50626, -0.50626, -0.50626, -0.50473];
T3=[ 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60299, 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60299, 1.60452, 1.60452, 1.60452, 1.60452, 1.60452, 1.60299, 1.60299, 1.60299, 1.60299, 1.60299, 1.60299, 1.60299, 1.60299, 1.60299, 1.60145, 1.59992, 1.59685, 1.59532, 1.59532, 1.59532, 1.59839, 1.60452, 1.61219, 1.61526, 1.61679, 1.61679, 1.61679, 1.61833, 1.61833, 1.61833, 1.61986, 1.62140, 1.62140, 1.62293, 1.62600, 1.63213, 1.63520, 1.63980, 1.64594, 1.64747, 1.64747, 1.64747, 1.64747, 1.64747, 1.64901, 1.64747, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64901, 1.64747, 1.64594, 1.64441, 1.63060, 1.63060, 1.62907, 1.62600, 1.62600, 1.62446, 1.61679, 1.60912, 1.59685, 1.58458, 1.57231, 1.55697, 1.53703, 1.51708, 1.49407, 1.46953, 1.44038, 1.32073, 1.26858, 1.18881, 1.11671, 1.07069, 1.05228, 1.03694, 1.01393, 0.99399, 0.97098, 0.94797, 0.93263, 0.92036, 0.90962, 0.89735, 0.88354, 0.87127, 0.85593, 0.84059, 0.82525, 0.81144, 0.79304, 0.77770, 0.75929, 0.74241, 0.72247, 0.70560, 0.68719, 0.67185, 0.65651, 0.63964, 0.62583, 0.60896, 0.59208, 0.57674, 0.55527, 0.53993, 0.52305, 0.51385, 0.49851, 0.48163, 0.46783, 0.45095, 0.43561, 0.42794, 0.41567, 0.40033, 0.38959, 0.38192, 0.37732, 0.37425, 0.37119, 0.36965, 0.36812, 0.36658, 0.36505, 0.36505, 0.36505, 0.36505, 0.35738, 0.35124, 0.34664, 0.34204, 0.33744, 0.33590, 0.33590, 0.33590, 0.33437, 0.33437, 0.33437, 0.33130, 0.32823, 0.32056, 0.31289, 0.30676, 0.30216, 0.30062, 0.30062, 0.29909, 0.29602, 0.29602, 0.29602, 0.29449, 0.29449, 0.29295, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29602, 0.29449, 0.29449, 0.29449, 0.29449, 0.29449, 0.29295, 0.29295, 0.29295, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29142, 0.29142, 0.28988, 0.28835, 0.28682, 0.28682, 0.28682, 0.28682, 0.28528, 0.28528, 0.28375, 0.28221, 0.28375, 0.28682, 0.28835, 0.28835, 0.28835, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29142, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295, 0.29295];
T4=[ 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26381, 0.26227, 0.26381, 0.26381, 0.26381, 0.26227, 0.26227, 0.26227, 0.26381, 0.26381, 0.26687, 0.26994, 0.27608, 0.28221, 0.28835, 0.29295, 0.30216, 0.30983, 0.31750, 0.32823, 0.33897, 0.34971, 0.36198, 0.37425, 0.38806, 0.40187, 0.41874, 0.44022, 0.46476, 0.49084, 0.51538, 0.53686, 0.56600, 0.57367, 0.58901, 0.60435, 0.61816, 0.62736, 0.63810, 0.65037, 0.66418, 0.68566, 0.70253, 0.72094, 0.73935, 0.75775, 0.77463, 0.78843, 0.80531, 0.82218, 0.83752, 0.85593, 0.87127, 0.88814, 0.90348, 0.92189, 0.93263, 0.95257, 0.96791, 0.98479, 1.00166, 1.02314, 1.04154, 1.06302, 1.08450, 1.10290, 1.11978, 1.13358, 1.14892, 1.16580, 1.18267, 1.19955, 1.21182, 1.21642, 1.22256, 1.22869, 1.23636, 1.23943, 1.24403, 1.24403, 1.24403, 1.24557, 1.24557, 1.24403, 1.24403, 1.24403, 1.24403, 1.24403, 1.24403, 1.24250, 1.23636, 1.22716, 1.21642, 1.21182, 1.21028, 1.20722, 1.20722, 1.20722, 1.20722, 1.20722, 1.20722, 1.20722, 1.20722, 1.20722, 1.20722, 1.20568, 1.20722, 1.20722, 1.20415, 1.20415, 1.20415, 1.19801, 1.19648, 1.19188, 1.18727, 1.18267, 1.17960, 1.17347, 1.16580, 1.15506, 1.14586, 1.13512, 1.12131, 1.10444, 1.08910, 1.07376, 1.06149, 1.04615, 1.03541, 1.02160, 1.01086, 0.99706, 0.98479, 0.96945, 0.96024, 0.94644, 0.93263, 0.91882, 0.90655, 0.89275, 0.88201, 0.87127, 0.86360, 0.85900, 0.85286, 0.85133, 0.85133, 0.84979, 0.84826, 0.84826, 0.84826, 0.84979, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84979, 0.84979, 0.84979, 0.84826, 0.84826, 0.84826, 0.84979, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84979, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84673, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84979, 0.84826, 0.84826, 0.84826, 0.84826, 0.84979, 0.84826, 0.84979, 0.84826, 0.84826, 0.84979, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84979, 0.84826, 0.84826, 0.84826, 0.84979, 0.84979, 0.84826, 0.84979, 0.84826, 0.84826, 0.84826, 0.84826, 0.84673, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826, 0.84826];
%plot(1:size(T1),T1)

% figure(2001);
% hold on;
% plot(T1(1,1:end),'k *');
% figure(2002);
% hold on;
% plot(T2(1,1:end),'k *');
% figure(2003);
% hold on;
% plot(T3(1,1:end),'k *');
% figure(2004);
% hold on;
% plot(T4(1,1:end),'k *');
dt=0.001;
tau=1;
n_rfs=5;
goal=0;
init=0;
len=tau/dt;
x=1:300;
xx=linspace(1,300,floor(len)+ 3);

traj=csaps(x,T2',0.9,xx);


figure(6001);
hold on;
plot(traj,'k--');
drawnow


  
% T1=filtfilt(ones(1,10)/10,1,T1);
% T2=filtfilt(ones(1,10)/10,1,T2);
% T3=filtfilt(ones(1,10)/10,1,T3);
% T4=filtfilt(ones(1,10)/10,1,T4);
name1='MoroLElbowRoll';
name2='MoroLElbowYaw';
name3='MoroLShoulderPitch';
name4='MoroLShoulderRoll';

dt=0.001;
tau=1;
n_rfs=15;
goal=0;
init=0;
len=tau/dt;

rootMeanSquareError = 1;
minpoint=[rootMeanSquareError;n_rfs];
cont=0;
epsilon=0.001;
THR = 1;
while(cont < 20)
    Y = learn_dcp_batch_oa(2,dt,goal,tau,n_rfs,init,traj',0,len,name1);
    error = Y(:,1) - traj(1:1001)';
    squareError = error.^2;
    meanSquareError = mean(squareError);
    rootMeanSquareError = sqrt(meanSquareError);
    if(rootMeanSquareError<minpoint(1))
        minpoint=[rootMeanSquareError;n_rfs];
        cont=0;
    else
        cont=cont+1;
    end
    cont
    n_rfs=n_rfs+5;
end
disp('n_rfs trovato')
minpoint(2)
Y = learn_dcp_batch_oa(1,dt,goal,tau,minpoint(2),init,traj',0,len,name1);

figure(1);
hold on;
plot(Y(:,1),'r');
plot(traj,'k')
drawnow
% 
% x=1:300;
% xx=linspace(1,300,floor(len+1)+ 3);
% %traj=csaps(x,T1',0.9,xx);
% traj(1:3)=T1(1);
% traj(4:303)=T1;
% learn_dcp_batch_oa(1,dt,goal,tau,n_rfs,init,traj',0,len,name1);
% %traj=csaps(x,T2',0.9,xx);
% traj(1:3)=T2(1);
% traj(4:303)=T2;
% learn_dcp_batch_oa(2,dt,goal,tau,n_rfs,init,traj',0,len,name2);
% %traj=csaps(x,T3',0.9,xx);
% traj(1:3)=T3(1);
% traj(4:303)=T3;
% learn_dcp_batch_oa(3,dt,goal,tau,n_rfs,init,traj',0,len,name3);
% %traj=csaps(x,T4',0.9,xx);
% traj(1:3)=T4(1);
% traj(4:303)=T4;
% learn_dcp_batch_oa(4,dt,goal,tau,n_rfs,init,traj',0,len,name4);




% global MOTION
% global NAMES
% MOTION.setStiffnesses('Body',1);
% timeLists=linspace(1,10,501);
% for i = 1:length(T1)
%     
%     trajNao = num2cell([T1(1,i),T2(1,i),T3(1,i),T4(1,i)]);
%     MOTION.angleInterpolationWithSpeed(NAMES,trajNao, 0.4);
% end
